import mongoose, {Schema} from "mongoose";
import bcrypt from "bcrypt"
import jwt from "jsonwebtoken"
import crypto from "crypto"

const userSchema = new Schema({
    avatar:{
        type:{
            url:String,
            localPath: String,
        },
        default:{
            url:`data:image/jpeg;base64,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`,
            localPath:""
        }
    },
    username:{
        type:String,
        required:true,
        unique:true,
        lowercase:true,
        trim:true,
        index:true
    },
    email:{
        type:String,
        required:true,
        unique:true,
        lowercase:true,
        trim:true,
    },
    password:{
        type: String,
        required: true
    },
    isEmailVerified:{
        type:Boolean,
        default:false
    },
    refreshToken:{
        type:String
    },
    forgotPasswordToken:{
        type:String
    },
    forgotPasswordExpiry:{
        type:Date
    },
    emailVerficationToken:{
        type:String
    },
    emailVerficationExpiry:{
        type:Date
    }
},{
    timestamps:true
});

userSchema.pre("save",async function (next) {
    if(!this.isModified("password")) return next();

    this.password = await bcrypt.hash(this.password,10)
    next()
})

userSchema.methods.isPasswordCorrect = async function (password) {
    return await bcrypt.compare(password, this.password)
    
}

userSchema.methods.generateAccessToken = function(){
    return jwt.sign({
        _id: this._id,
        email: this.email
    },
    process.env.ACCESS_TOKEN_SECRET,
    {expiresIn: process.env.ACCESS_TOKEN_EXPIRY}
)
}

userSchema.methods.generateRefreshToken = function(){
    return jwt.sign({
        _id: this._id,
    },
    process.env.REFRESH_TOKEN_SECRET,
    {expiresIn: process.env.REFRESH_TOKEN_EXPIRY}
)
}

userSchema.methods.generateTemporaryToken = function(){
    const unHashedToken = crypto.randomBytes(20).toString("hex")

    const hashedToken = crypto
    .createHash("sha256")
    .update(unHashedToken)
    .digest("hex")

    const tokenExpiry = Date.now() + (20*60*1000) //20min
    return {unHashedToken,hashedToken,tokenExpiry}
}


export const user = mongoose.model("User",userSchema)